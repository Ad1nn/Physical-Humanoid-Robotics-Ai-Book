<?xml version="1.0"?>
<robot name="simple_arm" xmlns:xacro="http://ros.org/xacro">

  <!-- Common Properties and Materials -->
  <xacro:property name="PI" value="3.14159265359" />

  <material name="black"><color rgba="0 0 0 1"/></material>
  <material name="white"><color rgba="1 1 1 1"/></material>
  <material name="red"><color rgba="0.8 0 0 1"/></material>
  <material name="green"><color rgba="0 0.8 0 1"/></material>
  <material name="blue"><color rgba="0 0 0.8 1"/></material>
  <material name="grey"><color rgba="0.7 0.7 0.7 1"/></material>

  <!-- Macro for common link properties (visual, collision, inertial) -->
  <xacro:macro name="default_link_properties" params="mass ixx iyy izz *visual_geom *collision_geom *inertial_origin">
    <inertial>
      <origin xyz="${inertial_origin}" rpy="0 0 0"/>
      <mass value="${mass}"/>
      <inertia ixx="${ixx}" ixy="0" ixz="0" iyy="${iyy}" iyz="0" izz="${izz}"/>
    </inertial>
    <visual><xacro:insert_block name="visual_geom"/></visual>
    <collision><xacro:insert_block name="collision_geom"/></collision>
  </xacro:macro>

  <!-- Base Link (fixed to world) -->
  <link name="world"/>
  <joint name="fixed_base_joint" type="fixed">
    <parent link="world"/>
    <child link="base_link"/>
    <origin xyz="0 0 0" rpy="0 0 0"/>
  </joint>

  <!-- Base Link for the Arm (a small fixed pedestal) -->
  <xacro:property name="pedestal_height" value="0.1"/>
  <link name="base_link">
    <xacro:default_link_properties mass="1.0" ixx="0.001" iyy="0.001" izz="0.001" inertial_origin="0 0 ${pedestal_height/2}">
      <visual_geom><geometry><cylinder radius="0.05" length="${pedestal_height}"/></geometry><material name="grey"/></visual_geom>
      <collision_geom><geometry><cylinder radius="0.05" length="${pedestal_height}"/></geometry></collision_geom>
    </xacro:default_link_properties>
  </link>

  <!-- Joint 1: Shoulder Pitch -->
  <xacro:property name="shoulder_length" value="0.2"/>
  <link name="shoulder_link">
    <xacro:default_link_properties mass="0.5" ixx="0.01" iyy="0.01" izz="0.01" inertial_origin="0 0 ${shoulder_length/2}">
      <visual_geom><geometry><cylinder radius="0.03" length="${shoulder_length}"/></geometry><material name="green"/></visual_geom>
      <collision_geom><geometry><cylinder radius="0.03" length="${shoulder_length}"/></geometry></collision_geom>
    </xacro:default_link_properties>
  </link>
  <joint name="shoulder_pitch_joint" type="revolute">
    <parent link="base_link"/>
    <child link="shoulder_link"/>
    <origin xyz="0 0 ${pedestal_height}" rpy="0 0 0"/>
    <axis xyz="0 1 0"/>
    <limit lower="-${PI/2}" upper="${PI/2}" effort="10" velocity="1"/>
  </joint>

  <!-- Joint 2: Elbow Pitch -->
  <xacro:property name="elbow_length" value="0.2"/>
  <link name="elbow_link">
    <xacro:default_link_properties mass="0.3" ixx="0.005" iyy="0.005" izz="0.005" inertial_origin="0 0 ${elbow_length/2}">
      <visual_geom><geometry><cylinder radius="0.025" length="${elbow_length}"/></geometry><material name="blue"/></visual_geom>
      <collision_geom><geometry><cylinder radius="0.025" length="${elbow_length}"/></geometry></collision_geom>
    </xacro:default_link_properties>
  </link>
  <joint name="elbow_pitch_joint" type="revolute">
    <parent link="shoulder_link"/>
    <child link="elbow_link"/>
    <origin xyz="0 0 ${shoulder_length}" rpy="0 0 0"/>
    <axis xyz="0 1 0"/>
    <limit lower="0" upper="${PI}" effort="8" velocity="0.8"/>
  </joint>

  <!-- Joint 3: Wrist Pitch -->
  <xacro:property name="wrist_length" value="0.05"/>
  <link name="wrist_link">
    <xacro:default_link_properties mass="0.1" ixx="0.001" iyy="0.001" izz="0.001" inertial_origin="0 0 ${wrist_length/2}">
      <visual_geom><geometry><cylinder radius="0.02" length="${wrist_length}"/></geometry><material name="red"/></visual_geom>
      <collision_geom><geometry><cylinder radius="0.02" length="${wrist_length}"/></geometry></collision_geom>
    </xacro:default_link_properties>
  </link>
  <joint name="wrist_pitch_joint" type="revolute">
    <parent link="elbow_link"/>
    <child link="wrist_link"/>
    <origin xyz="0 0 ${elbow_length}" rpy="0 0 0"/>
    <axis xyz="0 1 0"/>
    <limit lower="-${PI/4}" upper="${PI/4}" effort="5" velocity="0.5"/>
  </joint>

  <!-- End Effector (fixed for now) -->
  <link name="end_effector_link">
    <xacro:default_link_properties mass="0.05" ixx="0.0001" iyy="0.0001" izz="0.0001" inertial_origin="0 0 0.02">
      <visual_geom><geometry><box size="0.04 0.04 0.04"/></geometry><material name="black"/></visual_geom>
      <collision_geom><geometry><box size="0.04 0.04 0.04"/></geometry></collision_geom>
    </xacro:default_link_properties>
  </link>
  <joint name="wrist_to_end_effector_fixed_joint" type="fixed">
    <parent link="wrist_link"/>
    <child link="end_effector_link"/>
    <origin xyz="0 0 ${wrist_length}" rpy="0 0 0"/>
  </joint>

</robot>